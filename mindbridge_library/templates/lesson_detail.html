{% extends 'main.html' %}
{% load static %}

{% block content %}
<div class="lesson-container">
    <h1>{{ lesson.title }}</h1>
    <p class="author">Author: {{ lesson.author.get_full_name|default:lesson.author.username }}</p>

    {% if lesson.format == 'video' %}
        <div class="video-wrapper">
            {% if lesson.video_url %}
                {% if 'youtube.com' in lesson.video_url or 'youtu.be' in lesson.video_url %}
                    <iframe src="https://www.youtube.com/embed/{{ lesson.video_url|slice:'-11:' }}"
                            allowfullscreen></iframe>
                {% elif 'vimeo.com' in lesson.video_url %}
                    <iframe src="https://player.vimeo.com/video/{{ lesson.video_url|slice:'18:' }}"
                            allowfullscreen></iframe>
                {% else %}
                    <video controls>
                        <source src="{{ lesson.video_url }}">
                    </video>
                {% endif %}
            {% else %}
                <video controls>
                    <source src="{{ lesson.video_file.url }}">
                </video>
            {% endif %}
        </div>
    {% endif %}

    <div class="lesson-body">
        <h2>Lesson Content</h2>
        {{ lesson.content|linebreaks }}
    </div>

    {% if attachments %}
    <div class="lesson-attachments">
        <h3>Downloads</h3>
        <ul>
            {% for attachment in attachments %}
            <li>
                <a href="{{ attachment.pdf_file.url }}" download>
                    <i class="fas fa-file-pdf"></i> {{ attachment.title }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>

<style>
    .lesson-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }

    .author {
        color: #666;
        margin-bottom: 20px;
    }

    .video-wrapper {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        margin-bottom: 20px;
    }

    .video-wrapper iframe,
    .video-wrapper video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }

    .lesson-body {
        margin: 30px 0;
    }

    .lesson-attachments ul {
        list-style: none;
        padding: 0;
    }

    .lesson-attachments li {
        margin: 10px 0;
    }

    .lesson-attachments a {
        color: #d63384;
        text-decoration: none;
    }

    .lesson-attachments a:hover {
        text-decoration: underline;
    }

    .fa-file-pdf {
        margin-right: 8px;
        color: #d63384;
    }
</style>
{% endblock %}